<h1>Timeline</h1>
<%= link_to "mypage", user_path(current_user.id) %><br/>
<%= link_to "log out", destroy_user_session_path, method: :delete %>
<ul>
  <% @tweets.each do |t| %>
    <% if Reply.where(tweet_id: t.id).present? then next end %>
    <li>
      <% @users.each do |u| %>
        <% if u.id == t.user_id %>
          <%= u.name %>
        <% end %>
      <% end %>
      <br/>
      <%= t.text %><br/>
      <% #t.photo %>
      <%= link_to "reply", new_user_tweet_reply_path(current_user.id,t) %>
      <%= link_to "like", user_tweet_favs_path(current_user.id,t), method: :post %>
      <%= link_to "like解除", user_tweet_favs_path(current_user.id,t), method: :delete %>
      <% if t.user_id == current_user.id %>
        <%= link_to "x", user_tweet_path(t.user_id,t), method: :delete, data: {confirm: "Are you sure?"} %>
      <% end %>
      <%# replyがある場合replyを表示する %>
      <ul>
        <% @replies.each do |r| %>
          <% if r.target_tweet_id == t.id %>
            <% @tweets.each do |tr| %>
              <% if r.tweet_id == tr.id %>
                <li>
                  <% @users.each do |ur| %>
                    <% if ur.id == tr.user_id %>
                      <%= ur.name %><br/>
                    <% end %>
                  <% end %>
                  <%= tr.text %>
                </li>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      </ul>
    </li>
  <% end %>
</ul>
